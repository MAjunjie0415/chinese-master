# æ€§èƒ½ä¼˜åŒ–é€šç”¨æ–¹æ¡ˆ

## ğŸ“Š é—®é¢˜è¯Šæ–­æµç¨‹

### 1. è¯†åˆ«æ€§èƒ½ç“¶é¢ˆ

**å¸¸è§ç—‡çŠ¶**ï¼š
- é¡µé¢åŠ è½½æ—¶é—´ > 2 ç§’
- ç”¨æˆ·ç‚¹å‡»åç­‰å¾…æ—¶é—´é•¿ï¼ˆ> 1 ç§’ï¼‰
- ç™½å±æ—¶é—´è¿‡é•¿
- å¯¼èˆªåˆ‡æ¢å¡é¡¿

**è¯Šæ–­æ–¹æ³•**ï¼š
1. æ£€æŸ¥æœåŠ¡ç«¯ç»„ä»¶ä¸­çš„æ•°æ®è·å–é€»è¾‘
2. ç»Ÿè®¡æ•°æ®åº“æŸ¥è¯¢æ•°é‡å’Œæ‰§è¡Œæ–¹å¼ï¼ˆä¸²è¡Œ vs å¹¶è¡Œï¼‰
3. æ£€æŸ¥æ˜¯å¦æœ‰å¤æ‚çš„ JOIN æŸ¥è¯¢
4. æŸ¥çœ‹æ˜¯å¦æœ‰ç¼ºå¤±çš„æ•°æ®åº“ç´¢å¼•

### 2. æ€§èƒ½ç“¶é¢ˆç±»å‹

#### ç±»å‹ Aï¼šä¸²è¡Œæ•°æ®åº“æŸ¥è¯¢
**é—®é¢˜**ï¼šå¤šä¸ªæŸ¥è¯¢æŒ‰é¡ºåºæ‰§è¡Œï¼Œæ€»è€—æ—¶ = æ‰€æœ‰æŸ¥è¯¢æ—¶é—´ä¹‹å’Œ
```typescript
// âŒ ä¸²è¡ŒæŸ¥è¯¢ï¼ˆæ…¢ï¼‰
const result1 = await db.select(...);  // ç­‰å¾… 1 ç§’
const result2 = await db.select(...);  // å†ç­‰å¾… 1 ç§’
const result3 = await db.select(...);  // å†ç­‰å¾… 1 ç§’
// æ€»è€—æ—¶: 3 ç§’
```

#### ç±»å‹ Bï¼šç¼ºå°‘æ•°æ®åº“ç´¢å¼•
**é—®é¢˜**ï¼šJOIN æŸ¥è¯¢æˆ– WHERE æ¡ä»¶æŸ¥è¯¢æ²¡æœ‰ç´¢å¼•ï¼Œå¯¼è‡´å…¨è¡¨æ‰«æ
```typescript
// âŒ æ²¡æœ‰ç´¢å¼•çš„ JOIN
.innerJoin(courseWords, eq(userProgress.word_id, courseWords.word_id))
// å¦‚æœ course_words.word_id æ²¡æœ‰ç´¢å¼•ï¼Œä¼šå¾ˆæ…¢
```

#### ç±»å‹ Cï¼šé˜»å¡æ¸²æŸ“
**é—®é¢˜**ï¼šæ‰€æœ‰æ•°æ®è·å–å®Œæˆåæ‰æ¸²æŸ“é¡µé¢ï¼Œç”¨æˆ·çœ‹åˆ°é•¿æ—¶é—´ç™½å±
```typescript
// âŒ é˜»å¡æ¸²æŸ“
const data = await fetchAllData();  // ç­‰å¾… 4 ç§’
return <Page data={data} />;  // 4 ç§’åæ‰æ˜¾ç¤º
```

---

## âœ… é€šç”¨ä¼˜åŒ–æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1ï¼šå¹¶è¡ŒæŸ¥è¯¢ä¼˜åŒ–ï¼ˆPromise.allï¼‰

**é€‚ç”¨åœºæ™¯**ï¼šå¤šä¸ªç‹¬ç«‹çš„æ•°æ®åº“æŸ¥è¯¢

**ä¼˜åŒ–å‰**ï¼š
```typescript
// ä¸²è¡Œæ‰§è¡Œ
const courses = await db.select(...).from(courses);
const userProgress = await db.select(...).from(userCourses);
const stats = await db.select(...).from(userProgress);
// æ€»è€—æ—¶: æŸ¥è¯¢1 + æŸ¥è¯¢2 + æŸ¥è¯¢3
```

**ä¼˜åŒ–å**ï¼š
```typescript
// å¹¶è¡Œæ‰§è¡Œ
const [courses, userProgress, stats] = await Promise.all([
  db.select(...).from(courses),
  db.select(...).from(userCourses),
  db.select(...).from(userProgress),
]);
// æ€»è€—æ—¶: max(æŸ¥è¯¢1, æŸ¥è¯¢2, æŸ¥è¯¢3)
```

**æ€§èƒ½æå‡**ï¼š50-70%ï¼ˆå–å†³äºæŸ¥è¯¢æ•°é‡ï¼‰

**æœ€ä½³å®è·µ**ï¼š
- âœ… åªå¯¹**ç‹¬ç«‹æŸ¥è¯¢**ä½¿ç”¨ Promise.allï¼ˆæŸ¥è¯¢ä¹‹é—´æ²¡æœ‰ä¾èµ–ï¼‰
- âœ… æ¡ä»¶æŸ¥è¯¢ä¹Ÿè¦å¹¶è¡ŒåŒ–ï¼ˆä½¿ç”¨ä¸‰å…ƒè¿ç®—ç¬¦ï¼‰
- âœ… é”™è¯¯å¤„ç†ï¼šå¦‚æœæŸä¸ªæŸ¥è¯¢å¤±è´¥ï¼Œå…¶ä»–æŸ¥è¯¢ä»å¯ç»§ç»­

**ç¤ºä¾‹**ï¼š
```typescript
// Profile é¡µé¢ä¼˜åŒ–ç¤ºä¾‹
const [
  totalLearnedResult,
  masteredResult,
  todayReviewsResult,
  enrolledCoursesResult,
  completedCoursesResult,
  practiceStatsResult,
  achievements,
] = await Promise.all([
  db.select({ count: count() }).from(userProgress).where(...),
  db.select({ count: count() }).from(userProgress).where(...),
  db.select({ count: count() }).from(userProgress).where(...),
  db.select({ count: count() }).from(userCourses).where(...),
  db.select({ count: count() }).from(userCourses).where(...),
  db.select({ count: count() }).from(practiceRecords).where(...),
  getUserAchievements(userId),
]);
```

---

### æ–¹æ¡ˆ 2ï¼šæµå¼æ¸²æŸ“ï¼ˆReact Suspenseï¼‰

**é€‚ç”¨åœºæ™¯**ï¼šæ•°æ®è·å–æ—¶é—´è¾ƒé•¿ï¼Œä½†é¡µé¢æœ‰é™æ€å†…å®¹å¯ä»¥ç«‹å³æ˜¾ç¤º

**ä¼˜åŒ–å‰**ï¼š
```typescript
// é˜»å¡æ¸²æŸ“
export default async function Page() {
  const data = await fetchData();  // ç­‰å¾… 4 ç§’
  return <div>{/* 4 ç§’åæ‰æ˜¾ç¤º */}</div>;
}
```

**ä¼˜åŒ–å**ï¼š
```typescript
// æµå¼æ¸²æŸ“
export default async function Page() {
  return (
    <div>
      {/* é™æ€å†…å®¹ç«‹å³æ˜¾ç¤º */}
      <StaticContent />
      <Suspense fallback={<Skeleton />}>
        <DataComponent />  {/* å¼‚æ­¥åŠ è½½ */}
      </Suspense>
    </div>
  );
}
```

**æ€§èƒ½æå‡**ï¼š
- ç”¨æˆ·æ„ŸçŸ¥ï¼šä»"ç­‰å¾… 4 ç§’" â†’ "ç«‹å³çœ‹åˆ°åŠ è½½çŠ¶æ€"
- å®é™…åŠ è½½æ—¶é—´å¯èƒ½ç›¸åŒï¼Œä½†ä½“éªŒæå‡ 80%+

**æœ€ä½³å®è·µ**ï¼š
1. **åˆ†ç¦»æ•°æ®è·å–ç»„ä»¶**
   ```typescript
   // app/components/ReviewCard.tsx
   async function ReviewData() {
     const data = await fetchData();
     return <ReviewCard data={data} />;
   }
   
   export default function ReviewCard() {
     return (
       <Suspense fallback={<ReviewCardSkeleton />}>
         <ReviewData />
       </Suspense>
     );
   }
   ```

2. **åˆ›å»ºç²¾ç¾çš„éª¨æ¶å±**
   ```typescript
   function ReviewCardSkeleton() {
     return (
       <div className="animate-pulse">
         <div className="h-12 bg-gray-200 rounded"></div>
         <div className="h-6 bg-gray-200 rounded"></div>
       </div>
     );
   }
   ```

3. **è½»é‡çº§æ•°æ®ç«‹å³è·å–**
   ```typescript
   // åªè·å–ç™»å½•çŠ¶æ€ï¼ˆè½»é‡çº§ï¼Œå¿«é€Ÿè¿”å›ï¼‰
   const isLoggedIn = await getLoginStatus();
   
   // æ•°æ®è·å–ä½¿ç”¨ Suspenseï¼ˆå¼‚æ­¥åŠ è½½ï¼‰
   {isLoggedIn && (
     <Suspense fallback={<Skeleton />}>
       <DataComponent />
     </Suspense>
   )}
   ```

---

### æ–¹æ¡ˆ 3ï¼šæ•°æ®åº“ç´¢å¼•ä¼˜åŒ–

**é€‚ç”¨åœºæ™¯**ï¼šJOIN æŸ¥è¯¢æˆ– WHERE æ¡ä»¶æŸ¥è¯¢æ€§èƒ½å·®

**ä¼˜åŒ–å‰**ï¼š
```typescript
// æ²¡æœ‰ç´¢å¼•çš„ JOIN
.innerJoin(courseWords, eq(userProgress.word_id, courseWords.word_id))
// å…¨è¡¨æ‰«æï¼Œå¾ˆæ…¢
```

**ä¼˜åŒ–å**ï¼š
```typescript
// æ·»åŠ ç´¢å¼•
// db/schema/courses.ts
wordIdIdx: index('course_words_word_id_idx').on(table.word_id),

// æŸ¥è¯¢ä½¿ç”¨ç´¢å¼•ï¼Œå¿«é€Ÿ
.innerJoin(courseWords, eq(userProgress.word_id, courseWords.word_id))
```

**æ€§èƒ½æå‡**ï¼š30-50%ï¼ˆå–å†³äºæ•°æ®é‡ï¼‰

**æœ€ä½³å®è·µ**ï¼š
1. **ä¸º JOIN å­—æ®µæ·»åŠ ç´¢å¼•**
   ```typescript
   // å¦‚æœç»å¸¸ JOIN è¿™ä¸¤ä¸ªå­—æ®µï¼Œéƒ½è¦æœ‰ç´¢å¼•
   .innerJoin(courseWords, eq(userProgress.word_id, courseWords.word_id))
   // user_progress.word_id åº”è¯¥æœ‰ç´¢å¼•
   // course_words.word_id ä¹Ÿåº”è¯¥æœ‰ç´¢å¼•
   ```

2. **ä¸º WHERE æ¡ä»¶æ·»åŠ ç´¢å¼•**
   ```typescript
   // å¦‚æœç»å¸¸æŒ‰è¿™äº›æ¡ä»¶æŸ¥è¯¢ï¼Œæ·»åŠ è”åˆç´¢å¼•
   .where(
     and(
       eq(userProgress.user_id, userId),  // éœ€è¦ç´¢å¼•
       lt(userProgress.next_review, todayEnd),  // éœ€è¦ç´¢å¼•
     )
   )
   
   // æ·»åŠ è”åˆç´¢å¼•
   userNextReviewIdx: index('user_progress_user_next_review_idx')
     .on(table.user_id, table.next_review),
   ```

3. **æ£€æŸ¥ç°æœ‰ç´¢å¼•**
   ```typescript
   // æŸ¥çœ‹ schema æ–‡ä»¶ï¼Œç¡®ä¿å…³é”®å­—æ®µéƒ½æœ‰ç´¢å¼•
   // å¤–é”®å­—æ®µé€šå¸¸è‡ªåŠ¨æœ‰ç´¢å¼•ï¼Œä½† JOIN çš„å­—æ®µä¹Ÿè¦æ£€æŸ¥
   ```

---

### æ–¹æ¡ˆ 4ï¼šåŠ è½½çŠ¶æ€ä¼˜åŒ–ï¼ˆloading.tsxï¼‰

**é€‚ç”¨åœºæ™¯**ï¼šæ‰€æœ‰é¡µé¢éƒ½åº”è¯¥æœ‰åŠ è½½çŠ¶æ€

**å®ç°æ–¹å¼**ï¼š
```typescript
// app/courses/loading.tsx
export default function CoursesLoading() {
  return (
    <div className="min-h-screen py-8 px-4">
      <div className="animate-pulse">
        {/* éª¨æ¶å±å†…å®¹ */}
      </div>
    </div>
  );
}
```

**æ€§èƒ½æå‡**ï¼š
- ç”¨æˆ·æ„ŸçŸ¥ï¼šä»"ç‚¹å‡»æ— ååº”" â†’ "ç«‹å³çœ‹åˆ°åŠ è½½çŠ¶æ€"
- ä½“éªŒæå‡ï¼š90%+

**æœ€ä½³å®è·µ**ï¼š
1. **ä¸ºæ¯ä¸ªè·¯ç”±åˆ›å»º loading.tsx**
   - `app/loading.tsx` - å…¨å±€åŠ è½½
   - `app/courses/loading.tsx` - è¯¾ç¨‹é¡µé¢åŠ è½½
   - `app/profile/loading.tsx` - ä¸ªäººä¸­å¿ƒåŠ è½½
   - `app/review/loading.tsx` - å¤ä¹ é¡µé¢åŠ è½½

2. **éª¨æ¶å±è®¾è®¡åŸåˆ™**
   - åŒ¹é…å®é™…å†…å®¹å¸ƒå±€
   - ä½¿ç”¨ `animate-pulse` åŠ¨ç”»
   - ä¿æŒç®€æ´ï¼Œä¸è¦è¿‡åº¦è®¾è®¡

---

### æ–¹æ¡ˆ 5ï¼šæŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥

#### 5.1 å…ˆæŸ¥è¯¢ countï¼Œå†æŸ¥è¯¢è¯¦æƒ…
```typescript
// âœ… ä¼˜åŒ–ï¼šå…ˆæŸ¥ count
const countResult = await db.select({ count: count() })...;
const count = countResult[0]?.count || 0;

// åªæœ‰åœ¨æœ‰æ•°æ®æ—¶æ‰æŸ¥è¯¢è¯¦æƒ…
if (count > 0) {
  const details = await db.select(...)...;
}
```

#### 5.2 é¿å…ä¸å¿…è¦çš„æŸ¥è¯¢
```typescript
// âŒ æœªç™»å½•ç”¨æˆ·ä¹ŸæŸ¥è¯¢ç”¨æˆ·æ•°æ®
const userData = await db.select(...).where(eq(user_id, userId));

// âœ… ä¼˜åŒ–ï¼šæ¡ä»¶æŸ¥è¯¢
const userData = userId 
  ? await db.select(...).where(eq(user_id, userId))
  : [];
```

#### 5.3 ä½¿ç”¨æ¡ä»¶å¹¶è¡ŒæŸ¥è¯¢
```typescript
// âœ… ä¼˜åŒ–ï¼šæ¡ä»¶æŸ¥è¯¢ä¹Ÿå¹¶è¡ŒåŒ–
const [courses, userProgress] = await Promise.all([
  db.select(...).from(courses),
  userId 
    ? db.select(...).from(userCourses).where(eq(user_id, userId))
    : Promise.resolve([]),
]);
```

---

## ğŸ¯ ä¼˜åŒ–å†³ç­–æ ‘

```
é¡µé¢åŠ è½½æ…¢ï¼Ÿ
â”œâ”€ æœ‰å¤šä¸ªç‹¬ç«‹æŸ¥è¯¢ï¼Ÿ
â”‚  â””â”€ âœ… ä½¿ç”¨ Promise.all å¹¶è¡Œæ‰§è¡Œ
â”‚
â”œâ”€ æŸ¥è¯¢æ¶‰åŠ JOINï¼Ÿ
â”‚  â”œâ”€ JOIN å­—æ®µæœ‰ç´¢å¼•ï¼Ÿ
â”‚  â”‚  â””â”€ âŒ æ·»åŠ ç´¢å¼•
â”‚  â””â”€ âœ… ä¼˜åŒ– JOIN é¡ºåº
â”‚
â”œâ”€ é¡µé¢æœ‰é™æ€å†…å®¹ï¼Ÿ
â”‚  â””â”€ âœ… ä½¿ç”¨ Suspense åˆ†ç¦»æ•°æ®è·å–
â”‚
â””â”€ ç”¨æˆ·ç‚¹å‡»æ— åé¦ˆï¼Ÿ
   â””â”€ âœ… æ·»åŠ  loading.tsx å’Œéª¨æ¶å±
```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–æ£€æŸ¥æ¸…å•

### æ•°æ®åº“å±‚é¢
- [ ] ä¸º JOIN å­—æ®µæ·»åŠ ç´¢å¼•
- [ ] ä¸º WHERE æ¡ä»¶å­—æ®µæ·»åŠ ç´¢å¼•
- [ ] ä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µæ·»åŠ è”åˆç´¢å¼•
- [ ] æ£€æŸ¥å¤–é”®å­—æ®µæ˜¯å¦æœ‰ç´¢å¼•

### æŸ¥è¯¢å±‚é¢
- [ ] ä½¿ç”¨ Promise.all å¹¶è¡Œæ‰§è¡Œç‹¬ç«‹æŸ¥è¯¢
- [ ] å…ˆæŸ¥è¯¢ countï¼Œå†æŒ‰éœ€æŸ¥è¯¢è¯¦æƒ…
- [ ] é¿å…ä¸å¿…è¦çš„æŸ¥è¯¢ï¼ˆæ¡ä»¶åˆ¤æ–­ï¼‰
- [ ] ä¼˜åŒ– JOIN é¡ºåºï¼ˆä»è¿‡æ»¤æ€§å¼ºçš„è¡¨å¼€å§‹ï¼‰

### æ¸²æŸ“å±‚é¢
- [ ] ä½¿ç”¨ Suspense åˆ†ç¦»æ•°æ®è·å–
- [ ] ä¸ºæ¯ä¸ªè·¯ç”±åˆ›å»º loading.tsx
- [ ] åˆ›å»ºç²¾ç¾çš„éª¨æ¶å±
- [ ] è½»é‡çº§æ•°æ®ç«‹å³è·å–ï¼Œé‡é‡çº§æ•°æ®å¼‚æ­¥åŠ è½½

### ç”¨æˆ·ä½“éªŒå±‚é¢
- [ ] å¯¼èˆªæ æ·»åŠ å³æ—¶è§†è§‰åé¦ˆ
- [ ] Link ç»„ä»¶å¯ç”¨ prefetch
- [ ] ä½¿ç”¨ router.push æä¾›å³æ—¶åé¦ˆ
- [ ] æ·»åŠ åŠ è½½åŠ¨ç”»å’Œè¿‡æ¸¡æ•ˆæœ

---

## ğŸ”§ å®é™…æ¡ˆä¾‹æ€»ç»“

### æ¡ˆä¾‹ 1ï¼šProfile é¡µé¢ï¼ˆ4 ç§’ â†’ 1.5 ç§’ï¼‰

**é—®é¢˜**ï¼š7 ä¸ªä¸²è¡Œæ•°æ®åº“æŸ¥è¯¢

**ä¼˜åŒ–**ï¼š
1. âœ… ä½¿ç”¨ Promise.all å¹¶è¡Œæ‰§è¡Œæ‰€æœ‰æŸ¥è¯¢
2. âœ… ä¼˜åŒ– getUserAchievements å†…éƒ¨æŸ¥è¯¢ï¼ˆä¹Ÿæ”¹ä¸ºå¹¶è¡Œï¼‰

**ç»“æœ**ï¼šæ€§èƒ½æå‡ 60-70%

### æ¡ˆä¾‹ 2ï¼šCourses é¡µé¢ï¼ˆ4 ç§’ â†’ 1.5 ç§’ï¼‰

**é—®é¢˜**ï¼š2 ä¸ªä¸²è¡ŒæŸ¥è¯¢ï¼ˆè¯¾ç¨‹åˆ—è¡¨ + ç”¨æˆ·è¿›åº¦ï¼‰

**ä¼˜åŒ–**ï¼š
1. âœ… ä½¿ç”¨ Promise.all å¹¶è¡Œæ‰§è¡Œ
2. âœ… æ¡ä»¶æŸ¥è¯¢ä¼˜åŒ–ï¼ˆæœªç™»å½•ç”¨æˆ·ç›´æ¥è¿”å›ç©ºæ•°ç»„ï¼‰

**ç»“æœ**ï¼šæ€§èƒ½æå‡ 50-60%

### æ¡ˆä¾‹ 3ï¼šReview é¡µé¢ï¼ˆ4 ç§’ â†’ ç«‹å³åé¦ˆï¼‰

**é—®é¢˜**ï¼šå¤æ‚ JOIN æŸ¥è¯¢ + é˜»å¡æ¸²æŸ“

**ä¼˜åŒ–**ï¼š
1. âœ… æ·»åŠ æ•°æ®åº“ç´¢å¼•ï¼ˆcourse_words.word_idï¼‰
2. âœ… ä½¿ç”¨ Suspense åˆ†ç¦»æ•°æ®è·å–
3. âœ… æ·»åŠ  loading.tsx éª¨æ¶å±

**ç»“æœ**ï¼š
- æŸ¥è¯¢æ€§èƒ½æå‡ 30-50%
- ç”¨æˆ·ä½“éªŒæå‡ 80%+ï¼ˆç«‹å³çœ‹åˆ°åŠ è½½çŠ¶æ€ï¼‰

### æ¡ˆä¾‹ 4ï¼šé¦–é¡µï¼ˆ2-3 ç§’ â†’ ç«‹å³æ˜¾ç¤ºï¼‰

**é—®é¢˜**ï¼šå¤ä¹ å¡ç‰‡æ•°æ®è·å–é˜»å¡é¡µé¢æ¸²æŸ“

**ä¼˜åŒ–**ï¼š
1. âœ… ä½¿ç”¨ Suspense åˆ†ç¦»å¤ä¹ å¡ç‰‡æ•°æ®è·å–
2. âœ… åªè·å–è½»é‡çº§ç™»å½•çŠ¶æ€
3. âœ… åˆ›å»º ReviewCard ç»„ä»¶ï¼ˆå¸¦ Suspenseï¼‰

**ç»“æœ**ï¼š
- é™æ€å†…å®¹ç«‹å³æ˜¾ç¤º
- æ•°æ®éƒ¨åˆ†å¼‚æ­¥åŠ è½½
- ç”¨æˆ·ä½“éªŒæå‡ 90%+

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡å¯¹æ¯”

| ä¼˜åŒ–æ–¹æ¡ˆ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|---------|--------|--------|------|
| å¹¶è¡ŒæŸ¥è¯¢ | ä¸²è¡Œæ‰§è¡Œ | Promise.all | 50-70% |
| æ•°æ®åº“ç´¢å¼• | å…¨è¡¨æ‰«æ | ç´¢å¼•æŸ¥è¯¢ | 30-50% |
| æµå¼æ¸²æŸ“ | é˜»å¡æ¸²æŸ“ | Suspense | ä½“éªŒæå‡ 80%+ |
| åŠ è½½çŠ¶æ€ | æ— åé¦ˆ | loading.tsx | ä½“éªŒæå‡ 90%+ |

---

## ğŸš€ å¿«é€Ÿä¼˜åŒ–æ¨¡æ¿

### æ¨¡æ¿ 1ï¼šå¹¶è¡ŒæŸ¥è¯¢ä¼˜åŒ–
```typescript
// ä¼˜åŒ–å‰
const data1 = await query1();
const data2 = await query2();
const data3 = await query3();

// ä¼˜åŒ–å
const [data1, data2, data3] = await Promise.all([
  query1(),
  query2(),
  query3(),
]);
```

### æ¨¡æ¿ 2ï¼šSuspense åˆ†ç¦»æ•°æ®è·å–
```typescript
// ä¼˜åŒ–å‰
export default async function Page() {
  const data = await fetchData();
  return <Content data={data} />;
}

// ä¼˜åŒ–å
async function DataComponent() {
  const data = await fetchData();
  return <Content data={data} />;
}

export default function Page() {
  return (
    <Suspense fallback={<Skeleton />}>
      <DataComponent />
    </Suspense>
  );
}
```

### æ¨¡æ¿ 3ï¼šæ·»åŠ æ•°æ®åº“ç´¢å¼•
```typescript
// db/schema/table.ts
export const table = pgTable('table', {
  id: integer('id').primaryKey(),
  foreignId: integer('foreign_id').notNull(),
  // ...
}, (table) => ({
  // ä¸º JOIN å­—æ®µæ·»åŠ ç´¢å¼•
  foreignIdIdx: index('table_foreign_id_idx').on(table.foreignId),
}));
```

---

## ğŸ“ æ€»ç»“

### æ ¸å¿ƒåŸåˆ™

1. **å¹¶è¡Œä¼˜äºä¸²è¡Œ**ï¼šç‹¬ç«‹æŸ¥è¯¢ä½¿ç”¨ Promise.all
2. **æµå¼ä¼˜äºé˜»å¡**ï¼šä½¿ç”¨ Suspense åˆ†ç¦»æ•°æ®è·å–
3. **ç´¢å¼•æ˜¯å…³é”®**ï¼šä¸º JOIN å’Œ WHERE å­—æ®µæ·»åŠ ç´¢å¼•
4. **å³æ—¶åé¦ˆ**ï¼šloading.tsx å’Œéª¨æ¶å±æä¾›å³æ—¶è§†è§‰åé¦ˆ

### ä¼˜åŒ–ä¼˜å…ˆçº§

1. **é«˜ä¼˜å…ˆçº§**ï¼šå¹¶è¡ŒæŸ¥è¯¢ä¼˜åŒ–ï¼ˆPromise.allï¼‰
2. **é«˜ä¼˜å…ˆçº§**ï¼šæ·»åŠ æ•°æ®åº“ç´¢å¼•
3. **ä¸­ä¼˜å…ˆçº§**ï¼šæµå¼æ¸²æŸ“ï¼ˆSuspenseï¼‰
4. **ä¸­ä¼˜å…ˆçº§**ï¼šåŠ è½½çŠ¶æ€ä¼˜åŒ–ï¼ˆloading.tsxï¼‰
5. **ä½ä¼˜å…ˆçº§**ï¼šæŸ¥è¯¢ç»†èŠ‚ä¼˜åŒ–ï¼ˆcount å…ˆæŸ¥ç­‰ï¼‰

### é¢„æœŸæ•ˆæœ

- **æŸ¥è¯¢æ€§èƒ½**ï¼šæå‡ 50-70%
- **ç”¨æˆ·ä½“éªŒ**ï¼šæå‡ 80-90%
- **é¡µé¢åŠ è½½**ï¼šä» 4 ç§’ â†’ 1-2 ç§’
- **ç”¨æˆ·æ„ŸçŸ¥**ï¼šä»"ç­‰å¾…" â†’ "ç«‹å³åé¦ˆ"

---

**æœ€åæ›´æ–°**ï¼š2025-01-XX  
**é€‚ç”¨ç‰ˆæœ¬**ï¼šNext.js 16 App Router + React 19

