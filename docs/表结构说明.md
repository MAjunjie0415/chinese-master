# 数据库表结构说明

## 重要：auth.users vs public.users

### auth.users（系统表，只读）
- **位置**：`auth` schema
- **管理**：由Supabase Auth系统管理
- **用途**：存储用户认证信息
- **字段**：id, email, encrypted_password, email_confirmed_at等
- **权限**：只读（通过Supabase Dashboard查看，不能直接修改）

### public.users（自定义表，需要创建）
- **位置**：`public` schema（默认schema）
- **管理**：由我们创建和管理
- **用途**：存储业务相关的用户数据
- **字段**：id（关联auth.users.id）, invite_quota, invited_count等
- **权限**：可读写（通过RLS策略控制）

## 关系说明

```
auth.users (系统表)
    ↓ (外键关联)
public.users (自定义表)
    ├── id → REFERENCES auth.users(id)
    ├── invite_quota (邀请额度)
    └── invited_count (已邀请人数)
```

## 创建public.users表

在Supabase SQL Editor中执行：

```sql
-- 创建public.users表
CREATE TABLE IF NOT EXISTS public.users (
  id text PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  invite_quota integer DEFAULT 3 NOT NULL,
  invited_count integer DEFAULT 0 NOT NULL,
  created_at timestamp DEFAULT now() NOT NULL,
  updated_at timestamp DEFAULT now() NOT NULL
);

-- 创建索引
CREATE INDEX IF NOT EXISTS idx_users_invite_quota ON public.users(invite_quota);
CREATE INDEX IF NOT EXISTS idx_users_invited_count ON public.users(invited_count);

-- 启用RLS
ALTER TABLE public.users ENABLE ROW LEVEL SECURITY;

-- RLS策略
CREATE POLICY "Users can view their own data"
  ON public.users FOR SELECT
  USING (auth.uid()::text = id);

CREATE POLICY "Users can update their own data"
  ON public.users FOR UPDATE
  USING (auth.uid()::text = id);

CREATE POLICY "Users can insert their own data"
  ON public.users FOR INSERT
  WITH CHECK (auth.uid()::text = id);
```

完整SQL脚本见：`scripts/create-users-table.sql`

## 验证表创建

```sql
-- 查看public schema下的users表
SELECT * FROM public.users LIMIT 1;

-- 查看表结构
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_schema = 'public' 
  AND table_name = 'users';
```

