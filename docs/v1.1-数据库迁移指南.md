# v1.1 æ•°æ®åº“è¿ç§»æŒ‡å—

## ğŸ“‹ è¿ç§»æ¦‚è¿°

æœ¬æ¬¡è¿ç§»å°†ä¸ºé¡¹ç›®æ–°å¢**4å¼ è¡¨**ï¼Œæ”¯æŒv1.1çš„è¯¾ç¨‹ç³»ç»ŸåŠŸèƒ½ï¼š

| è¡¨å | ç”¨é€” | å…³é”®å­—æ®µ |
|------|------|---------|
| `courses` | è¯¾ç¨‹ä¸»è¡¨ | id, title, slug, category, totalWords |
| `user_courses` | ç”¨æˆ·è¯¾ç¨‹å…³è”è¡¨ | user_id, course_id, progress, isCompleted |
| `course_words` | è¯¾ç¨‹å•è¯å…³è”è¡¨ | course_id, word_id, order |
| `practice_records` | ç»ƒä¹ è®°å½•è¡¨ | user_id, course_id, mode, accuracy |

**é‡è¦**ï¼šæœ¬æ¬¡è¿ç§»**ä¸ä¼šå½±å“**v1.0çš„æ ¸å¿ƒè¡¨ï¼ˆ`words`ã€`user_progress`ï¼‰ï¼Œç”¨æˆ·æ•°æ®å®Œå…¨å®‰å…¨ï¼

---

## âš ï¸ è¿ç§»å‰å‡†å¤‡

### 1. å¤‡ä»½æ•°æ®åº“ï¼ˆå¼ºçƒˆå»ºè®®ï¼‰

åœ¨Supabaseæ§åˆ¶å°è¿›è¡Œå¤‡ä»½ï¼š
1. ç™»å½• [Supabase Dashboard](https://supabase.com/dashboard)
2. é€‰æ‹©ä½ çš„é¡¹ç›®
3. å·¦ä¾§èœå• â†’ **Database** â†’ **Backups**
4. ç‚¹å‡» **Create Backup** â†’ ç­‰å¾…å¤‡ä»½å®Œæˆ

### 2. ç¡®è®¤ç¯å¢ƒå˜é‡

ç¡®ä¿ `.env.local` æ–‡ä»¶åŒ…å«æ­£ç¡®çš„æ•°æ®åº“è¿æ¥ä¿¡æ¯ï¼š
```bash
DATABASE_URL=postgresql://postgres.[your-project-ref]:[password]@[region].pooler.supabase.com:6543/postgres
```

### 3. ç¡®è®¤ä¾èµ–å·²å®‰è£…

```bash
npm install
```

---

## ğŸš€ æ‰§è¡Œè¿ç§»æ­¥éª¤

### æ­¥éª¤1ï¼šç”Ÿæˆè¿ç§»æ–‡ä»¶ï¼ˆå·²å®Œæˆâœ…ï¼‰

è¿ç§»æ–‡ä»¶å·²ç”Ÿæˆåœ¨ `db/migrations/0001_friendly_morph.sql`

å¦‚éœ€é‡æ–°ç”Ÿæˆï¼š
```bash
npm run db:generate
```

### æ­¥éª¤2ï¼šæ‰§è¡Œæ•°æ®åº“è¿ç§»

è¿è¡Œè¿ç§»è„šæœ¬å°†æ–°è¡¨åº”ç”¨åˆ°æ•°æ®åº“ï¼š

```bash
npm run db:migrate
```

**é¢„æœŸè¾“å‡º**ï¼š
```
ğŸ”„ å¼€å§‹æ•°æ®åº“è¿ç§»...
âœ… æ•°æ®åº“è¿ç§»æˆåŠŸï¼

æ–°å¢è¡¨:
  - courses (è¯¾ç¨‹ä¸»è¡¨)
  - user_courses (ç”¨æˆ·è¯¾ç¨‹å…³è”è¡¨)
  - course_words (è¯¾ç¨‹å•è¯å…³è”è¡¨)
  - practice_records (ç»ƒä¹ è®°å½•è¡¨)

âœ¨ æ‰€æœ‰æ“ä½œå®Œæˆï¼
```

### æ­¥éª¤3ï¼šéªŒè¯è¿ç§»ç»“æœ

è¿è¡ŒéªŒè¯è„šæœ¬ç¡®ä¿è¿ç§»æˆåŠŸï¼š

```bash
npx tsx scripts/verify-v1.1-database.ts
```

**é¢„æœŸè¾“å‡º**ï¼š
```
ğŸ” å¼€å§‹éªŒè¯v1.1æ•°æ®åº“ç»“æ„...

âœ… éªŒè¯v1.0æ ¸å¿ƒè¡¨...
  âœ“ wordsè¡¨: [æ•°é‡] æ¡è®°å½•
  âœ“ user_progressè¡¨: [æ•°é‡] æ¡è®°å½•

âœ… éªŒè¯v1.1æ–°å¢è¡¨...
  âœ“ coursesè¡¨: 0 æ¡è®°å½•
  âœ“ user_coursesè¡¨: 0 æ¡è®°å½•
  âœ“ course_wordsè¡¨: 0 æ¡è®°å½•
  âœ“ practice_recordsè¡¨: 0 æ¡è®°å½•

âœ… éªŒè¯ç´¢å¼•...
  âœ“ æ‰¾åˆ° 10 ä¸ªç´¢å¼•

ğŸ‰ æ•°æ®åº“ç»“æ„éªŒè¯é€šè¿‡ï¼
```

### æ­¥éª¤4ï¼šåˆ›å»ºåˆå§‹è¯¾ç¨‹æ•°æ®ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦åˆ›å»ºç¤ºä¾‹è¯¾ç¨‹ï¼š

```bash
npm run seed:courses
```

è¿™å°†è‡ªåŠ¨åˆ›å»ºï¼š
- **3ä¸ªå•†åŠ¡æ±‰è¯­è¯¾ç¨‹**ï¼ˆè°ˆåˆ¤ã€é‚®ä»¶ã€ä¼šè®®ï¼‰
- **6ä¸ªHSKç­‰çº§è¯¾ç¨‹**ï¼ˆHSK1-6ï¼‰

**é¢„æœŸè¾“å‡º**ï¼š
```
ğŸŒ± å¼€å§‹åˆ›å»ºåˆå§‹è¯¾ç¨‹æ•°æ®...

ğŸ“š åˆ›å»ºå•†åŠ¡æ±‰è¯­è¯¾ç¨‹...
  âœ“ åˆ›å»ºè¯¾ç¨‹: Business Negotiation Essentials
    â†’ æ·»åŠ äº† 30 ä¸ªå•è¯
  âœ“ åˆ›å»ºè¯¾ç¨‹: Business Email Writing
    â†’ æ·»åŠ äº† 25 ä¸ªå•è¯
  âœ“ åˆ›å»ºè¯¾ç¨‹: Meeting and Presentation Skills
    â†’ æ·»åŠ äº† 30 ä¸ªå•è¯

ğŸ“š åˆ›å»ºHSKç­‰çº§è¯¾ç¨‹...
  âœ“ åˆ›å»ºè¯¾ç¨‹: HSK 1 Foundation
    â†’ æ·»åŠ äº† 50 ä¸ªå•è¯
  ... (ä»¥æ­¤ç±»æ¨)

âœ… è¯¾ç¨‹æ•°æ®åˆ›å»ºå®Œæˆï¼

ğŸ“Š ç»Ÿè®¡:
  - æ€»è¯¾ç¨‹æ•°: 9
  - å•†åŠ¡è¯¾ç¨‹: 3
  - HSKè¯¾ç¨‹: 6
```

---

## ğŸ” éªŒè¯è¿ç§»æˆåŠŸ

### æ–¹æ³•1ï¼šä½¿ç”¨Drizzle Studioï¼ˆæ¨èï¼‰

æ‰“å¼€å¯è§†åŒ–æ•°æ®åº“ç®¡ç†ç•Œé¢ï¼š

```bash
npm run db:studio
```

æµè§ˆå™¨ä¼šè‡ªåŠ¨æ‰“å¼€ `https://local.drizzle.studio`ï¼Œå¯ä»¥æŸ¥çœ‹æ‰€æœ‰è¡¨å’Œæ•°æ®ã€‚

### æ–¹æ³•2ï¼šSupabase SQLç¼–è¾‘å™¨

åœ¨Supabaseæ§åˆ¶å°æ‰§è¡ŒæŸ¥è¯¢ï¼š

```sql
-- æŸ¥çœ‹æ‰€æœ‰æ–°å¢è¡¨
SELECT table_name 
FROM information_schema.tables 
WHERE table_schema = 'public' 
  AND table_name IN ('courses', 'user_courses', 'course_words', 'practice_records');

-- æŸ¥çœ‹coursesè¡¨ç»“æ„
SELECT column_name, data_type, is_nullable 
FROM information_schema.columns 
WHERE table_name = 'courses';
```

---

## âŒ å›æ»šè¿ç§»ï¼ˆå¦‚æœ‰é—®é¢˜ï¼‰

å¦‚æœè¿ç§»å‡ºç°é—®é¢˜ï¼Œå¯ä»¥æ‰‹åŠ¨å›æ»šï¼š

### æ–¹æ³•1ï¼šä½¿ç”¨Supabaseæ¢å¤å¤‡ä»½
1. Supabase Dashboard â†’ Database â†’ Backups
2. é€‰æ‹©è¿ç§»å‰çš„å¤‡ä»½ â†’ Restore

### æ–¹æ³•2ï¼šæ‰‹åŠ¨åˆ é™¤æ–°è¡¨ï¼ˆä»…åˆ é™¤v1.1è¡¨ï¼‰

åœ¨Supabase SQLç¼–è¾‘å™¨æ‰§è¡Œï¼š

```sql
-- åˆ é™¤æ–°å¢çš„4å¼ è¡¨ï¼ˆæŒ‰ä¾èµ–é¡ºåºï¼‰
DROP TABLE IF EXISTS practice_records CASCADE;
DROP TABLE IF EXISTS course_words CASCADE;
DROP TABLE IF EXISTS user_courses CASCADE;
DROP TABLE IF EXISTS courses CASCADE;
```

**æ³¨æ„**ï¼šè¿™ä¸ä¼šå½±å“v1.0çš„ `words` å’Œ `user_progress` è¡¨ï¼

---

## ğŸ“Š è¿ç§»åæ•°æ®åº“ERå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   courses   â”‚ (æ–°å¢)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)     â”‚
â”‚ title       â”‚
â”‚ slug        â”‚
â”‚ category    â”‚
â”‚ totalWords  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1:N
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚              â”‚
       â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚user_courses â”‚  â”‚course_words â”‚ (æ–°å¢)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ user_id     â”‚  â”‚ course_id   â”‚
â”‚ course_id   â”‚  â”‚ word_id  â”€â”€â”€â”¼â”€â”€â–¶ wordsè¡¨ (v1.0)
â”‚ progress    â”‚  â”‚ order       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1:N
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚practice_     â”‚ (æ–°å¢)
â”‚records       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ user_id      â”‚
â”‚ course_id    â”‚
â”‚ mode         â”‚
â”‚ accuracy     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… è¿ç§»æ£€æŸ¥æ¸…å•

- [ ] å¤‡ä»½æ•°æ®åº“
- [ ] ç¡®è®¤ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡®
- [ ] æ‰§è¡Œ `npm run db:migrate`
- [ ] éªŒè¯è¿ç§»æˆåŠŸï¼ˆæ— é”™è¯¯è¾“å‡ºï¼‰
- [ ] è¿è¡Œ `npx tsx scripts/verify-v1.1-database.ts`
- [ ] ç¡®è®¤v1.0æ•°æ®æœªå—å½±å“
- [ ] ï¼ˆå¯é€‰ï¼‰åˆ›å»ºåˆå§‹è¯¾ç¨‹æ•°æ® `npm run seed:courses`
- [ ] å¯åŠ¨å¼€å‘æœåŠ¡å™¨ `npm run dev` æµ‹è¯•

---

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q1: æŠ¥é”™ "DATABASE_URL environment variable is not set"
**è§£å†³æ–¹æ¡ˆ**ï¼šæ£€æŸ¥ `.env.local` æ–‡ä»¶æ˜¯å¦å­˜åœ¨å¹¶åŒ…å«æ­£ç¡®çš„ `DATABASE_URL`ã€‚

### Q2: æŠ¥é”™ "relation already exists"
**è§£å†³æ–¹æ¡ˆ**ï¼šè¡¨å·²å­˜åœ¨ï¼Œæ— éœ€é‡æ–°è¿ç§»ã€‚å¦‚éœ€é‡æ–°è¿ç§»ï¼Œå…ˆåˆ é™¤ç°æœ‰è¡¨ã€‚

### Q3: å¦‚ä½•ç¡®è®¤v1.0åŠŸèƒ½ä¸å—å½±å“ï¼Ÿ
**è§£å†³æ–¹æ¡ˆ**ï¼š
1. è®¿é—® `/wordbanks/business` æµ‹è¯•å•è¯å­¦ä¹ åŠŸèƒ½
2. è®¿é—® `/review` æµ‹è¯•å¤ä¹ åŠŸèƒ½
3. æ£€æŸ¥ `user_progress` è¡¨æ•°æ®æ˜¯å¦å®Œæ•´

### Q4: è¿ç§»åæ— æ³•å¯åŠ¨devæœåŠ¡å™¨
**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ¸…é™¤Next.jsç¼“å­˜
rm -rf .next
npm run dev
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
1. é”™è¯¯æ—¥å¿—å®Œæ•´è¾“å‡º
2. æ•°æ®åº“ç±»å‹å’Œç‰ˆæœ¬
3. è¿ç§»å‰çš„è¡¨ç»“æ„æˆªå›¾

---

*æ–‡æ¡£ç‰ˆæœ¬ï¼šv1.1 | æœ€åæ›´æ–°ï¼š2025-10-31*


